import{Q as Y}from"./QPage.e7766711.js";import{Q as x}from"./QInput.274331f1.js";import{c as j,r as p,a0 as N,aj as W,s as z,h as G,d as J,g as K,a1 as H,ac as A,T as X,p as Z,aD as ee,z as F,L as b,C as V,D as a,B as _,t as $,M as D,aF as k,O as L,P as C,J as I,y as oe,aG as te}from"./index.fbbb49e6.js";import{b as ae}from"./uid.9b787859.js";import{u as R}from"./use-quasar.0a14f71b.js";import{_ as S}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-key-composition.3179d14c.js";import"./use-dark.03fbf057.js";var q=j({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:y,emit:c}){const d=K(),n=p(null);let i=0;const m=[];function u(o){const h=typeof o=="boolean"?o:e.noErrorFocus!==!0,w=++i,B=(l,f)=>{c("validation"+(l===!0?"Success":"Error"),f)},Q=l=>{const f=l.validate();return typeof f.then=="function"?f.then(v=>({valid:v,comp:l}),v=>({valid:!1,comp:l,err:v})):Promise.resolve({valid:f,comp:l})};return(e.greedy===!0?Promise.all(m.map(Q)).then(l=>l.filter(f=>f.valid!==!0)):m.reduce((l,f)=>l.then(()=>Q(f).then(v=>{if(v.valid===!1)return Promise.reject(v)})),Promise.resolve()).catch(l=>[l])).then(l=>{if(l===void 0||l.length===0)return w===i&&B(!0),!0;if(w===i){const{comp:f,err:v}=l[0];if(v!==void 0&&console.error(v),B(!1,f),h===!0){const M=l.find(({comp:U})=>typeof U.focus=="function"&&H(U.$)===!1);M!==void 0&&M.comp.focus()}}return!1})}function g(){i++,m.forEach(o=>{typeof o.resetValidation=="function"&&o.resetValidation()})}function t(o){o!==void 0&&A(o);const h=i+1;u().then(w=>{h===i&&w===!0&&(e.onSubmit!==void 0?c("submit",o):o!==void 0&&o.target!==void 0&&typeof o.target.submit=="function"&&o.target.submit())})}function s(o){o!==void 0&&A(o),c("reset"),X(()=>{g(),e.autofocus===!0&&e.noResetFocus!==!0&&r()})}function r(){ae(()=>{if(n.value===null)return;const o=n.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||n.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||n.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(n.value.querySelectorAll("[tabindex]"),h=>h.tabIndex>-1);o!=null&&o.focus({preventScroll:!0})})}Z(ee,{bindComponent(o){m.push(o)},unbindComponent(o){const h=m.indexOf(o);h>-1&&m.splice(h,1)}});let E=!1;return N(()=>{E=!0}),W(()=>{E===!0&&e.autofocus===!0&&r()}),z(()=>{e.autofocus===!0&&r()}),Object.assign(d.proxy,{validate:u,resetValidation:g,submit:t,reset:s,focus:r,getValidationComponents:()=>m}),()=>G("form",{class:"q-form",ref:n,onSubmit:t,onReset:s},J(y.default))}});const T=e=>(L("data-v-57ac0cde"),e=e(),C(),e),se={class:"signin"},ne=T(()=>a("div",{class:"text-green-10"},[a("h2",{class:"header"},"Sign in")],-1)),re=T(()=>a("div",null,"Sign in via magic link",-1)),le={__name:"MagicLinkForm",props:["toggleForm"],setup(e){const{toggleForm:y}=e,c=p(!1),d=p(""),n=R(),i=u=>{y(u)},m=async()=>{try{c.value=!0;const{error:u}=await I.auth.signInWithOtp({email:d.value});if(u)throw u;n.notify({color:"positive",position:"top",message:"Email sent. Check your inbox for the login link!"})}catch(u){u instanceof Error&&n.notify({color:"negative",position:"top",message:u.message})}finally{c.value=!1}};return(u,g)=>(F(),b(q,{class:"row flex-center flex",onSubmit:k(m,["prevent"])},{default:V(()=>[a("div",se,[ne,re,_(x,{required:"",color:"green-5",type:"email",placeholder:"Your email",modelValue:d.value,"onUpdate:modelValue":g[0]||(g[0]=t=>d.value=t)},null,8,["modelValue"]),_($,{icon:"mail",color:"green-5",label:"Send email",type:"submit",class:"btn"}),a("div",null,[D(" Login with "),a("span",{class:"clickable-text",onClick:g[1]||(g[1]=t=>i("LoginForm"))},"email & password.")])])]),_:1}))}};var ie=S(le,[["__scopeId","data-v-57ac0cde"]]);const P=e=>(L("data-v-33abfbe8"),e=e(),C(),e),ue={class:"signin"},ce=P(()=>a("div",{class:"text-green-10"},[a("h2",{class:"header"},"Login")],-1)),de=P(()=>a("div",null,"Don't have an account?",-1)),me=P(()=>a("div",{class:"divide"},"------------ OR ------------",-1)),ge={__name:"LoginForm",props:["toggleForm"],setup(e){const{toggleForm:y}=e,c=p(""),d=p(""),n=p(!1),i=R(),m=oe(),u=t=>{y(t)},g=async()=>{try{n.value=!0;const{error:t}=await I.auth.signInWithPassword({email:c.value,password:d.value});if(t)throw t;i.notify({color:"positive",position:"top",message:"Logged in successfully!",icon:"login"}),m.push("/")}catch(t){t instanceof Error&&i.notify({color:"negative",position:"top",message:t.message})}finally{n.value=!1}};return(t,s)=>(F(),b(q,{class:"row flex-center flex",onSubmit:k(g,["prevent"])},{default:V(()=>[a("div",ue,[ce,_(x,{required:"",color:"green-5",type:"text",placeholder:"Your email",modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=r=>c.value=r)},null,8,["modelValue"]),_(x,{required:"",color:"green-5",type:"password",placeholder:"Your password",modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=r=>d.value=r)},null,8,["modelValue"]),_($,{icon:"login",color:"green-5",label:"Login",type:"submit",class:"btn"}),a("div",null,[de,a("span",{class:"clickable-text",onClick:s[2]||(s[2]=r=>u("RegisterForm"))},"Register here."),me,a("div",null,[D(" Simply sign in with "),a("span",{class:"clickable-text",onClick:s[3]||(s[3]=r=>u("MagicLinkForm"))},"magic link.")])])])]),_:1}))}};var fe=S(ge,[["__scopeId","data-v-33abfbe8"]]);const O=e=>(L("data-v-5cac9149"),e=e(),C(),e),pe={class:"signin"},ve=O(()=>a("div",{class:"text-green-10"},[a("h2",{class:"header"},"Register")],-1)),_e=O(()=>a("div",null,"Already have an account?",-1)),ye={__name:"RegisterForm",props:["toggleForm"],setup(e){const{toggleForm:y}=e,c=p(""),d=p(""),n=p(""),i=p(!1),m=R(),u=t=>{y(t)},g=async()=>{try{if(d.value!==n.value)throw new Error("Passwords do not match");i.value=!0;const{error:t}=await I.auth.signUp({email:c.value,password:d.value});if(t)throw t;m.notify({color:"positive",position:"top",message:"Registered successfully!",icon:"check"})}catch(t){t instanceof Error&&m.notify({color:"negative",position:"top",message:t.message})}finally{i.value=!1}};return(t,s)=>(F(),b(q,{class:"row flex-center flex",onSubmit:k(g,["prevent"])},{default:V(()=>[a("div",pe,[ve,_(x,{required:"",color:"green-5",type:"text",placeholder:"Your email",modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=r=>c.value=r)},null,8,["modelValue"]),_(x,{required:"",color:"green-5",type:"password",placeholder:"Your password",modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=r=>d.value=r)},null,8,["modelValue"]),_(x,{required:"",color:"green-5",type:"password",placeholder:"Confirm password",modelValue:n.value,"onUpdate:modelValue":s[2]||(s[2]=r=>n.value=r)},null,8,["modelValue"]),_($,{icon:"person_add",color:"green-5",label:"Register",type:"submit",class:"btn"}),a("div",null,[_e,a("span",{class:"clickable-text",onClick:s[3]||(s[3]=r=>u("LoginForm"))},"Login here.")])])]),_:1}))}};var he=S(ye,[["__scopeId","data-v-5cac9149"]]);const xe={components:{MagicLinkForm:ie,LoginForm:fe,RegisterForm:he},data(){return{activeForm:"LoginForm"}},methods:{toggleForms(e){this.activeForm=e}}};function Fe(e,y,c,d,n,i){return F(),b(Y,{class:"flex flex-center justify-center"},{default:V(()=>[(F(),b(te(n.activeForm),{class:"form",toggleForm:i.toggleForms},null,8,["toggleForm"]))]),_:1})}var Re=S(xe,[["render",Fe],["__scopeId","data-v-16195a49"]]);export{Re as default};
