import{Q as g}from"./QSeparator.645d0fd9.js";import{Q as he}from"./QPage.e7766711.js";import{r as I,z as k,A as U,D as l,B as t,C as _,G as L,F as ae,I as se,t as Q,M,L as te,N as T,E as ie,H as q,a as F,g as ce,x as ye,ac as de,a3 as be,h as E,c as xe,Y as $e,a6 as Ce,J as W,O as fe,P as me,aH as Fe,K as we,aG as Ve}from"./index.fbbb49e6.js";import{Q as R,a as Y}from"./QItemSection.9255a723.js";import{b as Se,a as Ie,Q as ke}from"./QCard.d1c40a8f.js";import{Q as Pe}from"./QCardActions.f47ffc61.js";import{a as ze,Q as De,h as Ae}from"./format.2c147f7f.js";import{C as re,_ as Ne}from"./ClosePopup.153a809b.js";import{a as Qe}from"./axios.0d4d808a.js";import{u as Ue,d as qe,a as Ee,c as je,e as Be,b as Oe,f as ue}from"./use-key-composition.3179d14c.js";import{u as Te,Q as Me}from"./QInput.274331f1.js";import{u as pe}from"./use-quasar.0a14f71b.js";import{_ as G}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as Je}from"./QDate.ac5a18f2.js";import"./use-dark.03fbf057.js";import"./focusout.4067daa6.js";import"./uid.9b787859.js";import"./use-cache.b0833c75.js";const Le={class:"left-panel text-center"},Re={class:"q-pa-md"},Ye=["src"],He={class:"text-subtitle2 q-mt-md q-mb-xs"},We={class:"text-subtitle1 q-mt-md q-mb-xs"},Ge={class:"q-mt-md"},Xe=l("span",{class:"q-ml-sm"},[M("Are you sure you want to permanently delete your account? "),l("br"),M(" This action cannot be undone.")],-1),Ze={__name:"LeftPanelMenu",props:["togglePanel"],setup(e){const{togglePanel:r}=e,f=s=>{r(s)},v=async()=>{const s="https://igohglatbbhgyelsipze.supabase.co/functions/v1/delete-user-account",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlnb2hnbGF0YmJoZ3llbHNpcHplIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTkzNTI5NzMsImV4cCI6MjAxNDkyODk3M30.0kAm5Z0owBVjy1kzzbbFsAgeGdQVIH7oUHobIi4lQag",m={name:"kalhspera"},w={headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}};try{const x=await Qe.post(s,m,w);console.log("Response:",x.data)}catch(x){console.error("Error:",x)}},o=I(!1);return(s,i)=>(k(),U("div",Le,[l("div",Re,[t(ae,{size:"80px"},{default:_(()=>[l("img",{src:L(q).state.profile.avatar},null,8,Ye)]),_:1}),l("div",He,se(L(q).state.profile.userName),1),l("div",We,se(L(q).state.profile.fullName),1),l("div",Ge,[t(g),t(Y,null,{default:_(()=>[t(R,null,{default:_(()=>[t(Q,{flat:"",onClick:i[0]||(i[0]=m=>f("ChangeAvatar"))},{default:_(()=>[M("Change Avatar")]),_:1})]),_:1})]),_:1}),t(Y,null,{default:_(()=>[t(R,null,{default:_(()=>[t(Q,{flat:"",onClick:i[1]||(i[1]=m=>f("ProfileInfo"))},{default:_(()=>[M("Profile Information")]),_:1})]),_:1})]),_:1}),L(q).state.profile.isVerified?T("",!0):(k(),te(Y,{key:0},{default:_(()=>[t(R,null,{default:_(()=>[t(Q,{flat:"",onClick:i[2]||(i[2]=m=>f("UploadDocuments"))},{default:_(()=>[M("Upload documents")]),_:1})]),_:1})]),_:1})),t(g),t(Y,null,{default:_(()=>[t(R,{style:{color:"#dc143c"}},{default:_(()=>[t(Q,{label:"Delete Account",onClick:i[3]||(i[3]=m=>o.value=!0)})]),_:1}),t(ze,{modelValue:o.value,"onUpdate:modelValue":i[4]||(i[4]=m=>o.value=m),persistent:""},{default:_(()=>[t(Se,null,{default:_(()=>[t(Ie,{class:"row items-center"},{default:_(()=>[t(ae,{icon:"warning",color:"red-7","text-color":"white"}),Xe]),_:1}),t(Pe,{align:"right"},{default:_(()=>[ie(t(Q,{flat:"",label:"Cancel",color:"green-8"},null,512),[[re]]),ie(t(Q,{flat:"",label:"Delete my account",color:"red-7",onClick:v},null,512),[[re]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])])]))}};function j(e,r,f,v){const o=[];return e.forEach(s=>{v(s)===!0?o.push(s):r.push({failedPropValidation:f,file:s})}),o}function H(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),de(e)}const Ke={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},et=["rejected"];function tt({editable:e,dnd:r,getFileInput:f,addFilesToQueue:v}){const{props:o,emit:s,proxy:i}=ce(),m=I(null),w=F(()=>o.accept!==void 0?o.accept.split(",").map(n=>(n=n.trim(),n==="*"?"*/":(n.endsWith("/*")&&(n=n.slice(0,n.length-1)),n.toUpperCase()))):null),x=F(()=>parseInt(o.maxFiles,10)),P=F(()=>parseInt(o.maxTotalSize,10));function h(n){if(e.value)if(n!==Object(n)&&(n={target:null}),n.target!==null&&n.target.matches('input[type="file"]')===!0)n.clientX===0&&n.clientY===0&&ye(n);else{const S=f();S&&S!==n.target&&S.click(n)}}function p(n){e.value&&n&&v(null,n)}function $(n,S,B,O){let u=Array.from(S||n.target.files);const V=[],N=()=>{V.length!==0&&s("rejected",V)};if(o.accept!==void 0&&w.value.indexOf("*/")===-1&&(u=j(u,V,"accept",d=>w.value.some(y=>d.type.toUpperCase().startsWith(y)||d.name.toUpperCase().endsWith(y))),u.length===0))return N();if(o.maxFileSize!==void 0){const d=parseInt(o.maxFileSize,10);if(u=j(u,V,"max-file-size",y=>y.size<=d),u.length===0)return N()}if(o.multiple!==!0&&u.length!==0&&(u=[u[0]]),u.forEach(d=>{d.__key=d.webkitRelativePath+d.lastModified+d.name+d.size}),O===!0){const d=B.map(y=>y.__key);u=j(u,V,"duplicate",y=>d.includes(y.__key)===!1)}if(u.length===0)return N();if(o.maxTotalSize!==void 0){let d=O===!0?B.reduce((y,K)=>y+K.size,0):0;if(u=j(u,V,"max-total-size",y=>(d+=y.size,d<=P.value)),u.length===0)return N()}if(typeof o.filter=="function"){const d=o.filter(u);u=j(u,V,"filter",y=>d.includes(y))}if(o.maxFiles!==void 0){let d=O===!0?B.length:0;if(u=j(u,V,"max-files",()=>(d++,d<=x.value)),u.length===0)return N()}if(N(),u.length!==0)return u}function D(n){H(n),r.value!==!0&&(r.value=!0)}function c(n){de(n),(n.relatedTarget!==null||be.is.safari!==!0?n.relatedTarget!==m.value:document.elementsFromPoint(n.clientX,n.clientY).includes(m.value)===!1)===!0&&(r.value=!1)}function A(n){H(n);const S=n.dataTransfer.files;S.length!==0&&v(null,S),r.value=!1}function Z(n){if(r.value===!0)return E("div",{ref:m,class:`q-${n}__dnd absolute-full`,onDragenter:H,onDragover:H,onDragleave:c,onDrop:A})}return Object.assign(i,{pickFiles:h,addFiles:p}),{pickFiles:h,addFiles:p,onDragover:D,onDragleave:c,processFiles:$,getDndNode:Z,maxFilesNumber:x,maxTotalSizeNumber:P}}var le=xe({name:"QFile",inheritAttrs:!1,props:{...Ue,...qe,...Ke,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...Ee,...et],setup(e,{slots:r,emit:f,attrs:v}){const{proxy:o}=ce(),s=je(),i=I(null),m=I(!1),w=Be(e),{pickFiles:x,onDragover:P,onDragleave:h,processFiles:p,getDndNode:$}=tt({editable:s.editable,dnd:m,getFileInput:ne,addFilesToQueue:oe}),D=Te(e),c=F(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),A=F(()=>ue(c.value)),Z=F(()=>c.value.map(a=>a.name).join(", ")),n=F(()=>Ae(c.value.reduce((a,C)=>a+C.size,0))),S=F(()=>({totalSize:n.value,filesNumber:c.value.length,maxFiles:e.maxFiles})),B=F(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:w.value,...v,id:s.targetUid.value,disabled:s.editable.value!==!0})),O=F(()=>"q-file q-field--auto-height"+(m.value===!0?" q-file--dnd":"")),u=F(()=>e.multiple===!0&&e.append===!0);function V(a){const C=c.value.slice();C.splice(a,1),d(C)}function N(a){const C=c.value.indexOf(a);C>-1&&V(C)}function d(a){f("update:modelValue",e.multiple===!0?a:a[0])}function y(a){a.keyCode===13&&Ce(a)}function K(a){(a.keyCode===13||a.keyCode===32)&&x(a)}function ne(){return i.value}function oe(a,C){const z=p(a,C,c.value,u.value),ee=ne();ee!=null&&(ee.value=""),z!==void 0&&((e.multiple===!0?e.modelValue&&z.every(ve=>c.value.includes(ve)):e.modelValue===z[0])||d(u.value===!0?c.value.concat(z):z))}function J(){return[E("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function ge(){if(r.file!==void 0)return c.value.length===0?J():c.value.map((C,z)=>r.file({index:z,file:C,ref:this}));if(r.selected!==void 0)return c.value.length===0?J():r.selected({files:c.value,ref:this});if(e.useChips===!0)return c.value.length===0?J():c.value.map((C,z)=>E(De,{key:"file-"+z,removable:s.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{V(z)}},()=>E("span",{class:"ellipsis",textContent:C.name})));const a=e.displayValue!==void 0?e.displayValue:Z.value;return a.length!==0?[E("div",{class:e.inputClass,style:e.inputStyle,textContent:a})]:J()}function _e(){const a={ref:i,...B.value,...D.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:oe};return e.multiple===!0&&(a.multiple=!0),E("input",a)}return Object.assign(s,{fieldClass:O,emitValue:d,hasValue:A,inputRef:i,innerValue:c,floatingLabel:F(()=>A.value===!0||ue(e.displayValue)),computedCounter:F(()=>{if(e.counterLabel!==void 0)return e.counterLabel(S.value);const a=e.maxFiles;return`${c.value.length}${a!==void 0?" / "+a:""} (${n.value})`}),getControlChild:()=>$("file"),getControl:()=>{const a={ref:s.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return s.editable.value===!0&&Object.assign(a,{onDragover:P,onDragleave:h,onKeydown:y,onKeyup:K}),E("div",a,[_e()].concat(ge()))}}),Object.assign(o,{removeAtIndex:V,removeFile:N,getNativeElement:()=>i.value}),$e(o,"nativeEl",()=>i.value),Oe(s)}});const X=e=>(fe("data-v-6e06fb96"),e=e(),me(),e),lt={class:"avatarform"},nt=X(()=>l("br",null,null,-1)),ot=X(()=>l("p",{style:{"text-align":"left","font-weight":"bold"}},"Upload your Avatar:",-1)),at=X(()=>l("p",{style:{"font-size":"12px"}},"Browse files",-1)),st=X(()=>l("br",null,null,-1)),it={__name:"ChangeAvatar",setup(e){const r=I(null),f=I(!1),v=pe();async function o(){if(!r.value)return;f.value=!0;const s=Math.random().toString(36).substring(2,15),i=r.value.name.split(".").pop(),m=`${s}.${i}`,w=`https://igohglatbbhgyelsipze.supabase.co/storage/v1/object/public/avatars/${m}`;try{const{data:x,error:P}=await W.storage.from("avatars").upload(m,r.value,{cacheControl:"3600",upsert:!1});if(P)console.error("Error uploading avatar:",P.message);else{const{data:h,error:p}=await W.from("profiles").update({avatar_url:w}).eq("id",q.state.session.user.id).single();p?console.error("Error updating profile:",p.message):q.state.profile.avatar=w,v.notify({position:"top",color:"positive",message:"Avatar uploaded successfully"})}}catch(x){console.error("Unexpected error:",x.message)}finally{f.value=!1}}return(s,i)=>(k(),U("div",lt,[t(g,{color:"green",style:{width:"120%","margin-left":"-10%"}}),t(g,{color:"green",style:{width:"120%","margin-left":"-10%"}}),t(g,{color:"green",style:{width:"120%","margin-left":"-10%"}}),nt,ot,t(le,{modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=m=>r.value=m),color:"green-7"},null,8,["modelValue"]),at,t(g,{color:"green",style:{width:"120%","margin-left":"-10%"}}),t(g,{color:"green",style:{width:"120%","margin-left":"-10%"}}),t(g,{color:"green",style:{width:"120%","margin-left":"-10%"}}),st,t(Q,{onClick:o,color:"green-7",label:"Upload",loading:f.value},null,8,["loading"])]))}};var rt=G(it,[["__scopeId","data-v-6e06fb96"]]);const b=e=>(fe("data-v-5dcab339"),e=e(),me(),e),ut={class:"documentsform"},ct=b(()=>l("br",null,null,-1)),dt=b(()=>l("br",null,null,-1)),ft={class:"input_field"},mt=b(()=>l("p",{style:{"text-align":"left","font-weight":"bold"}}," Driver's license (Front side): ",-1)),pt=b(()=>l("p",{style:{"font-size":"12px"}},"Browse files",-1)),gt=b(()=>l("br",null,null,-1)),_t={class:"input_field"},vt=b(()=>l("p",{style:{"text-align":"left","font-weight":"bold"}}," Driver's license (Back side): ",-1)),ht=b(()=>l("p",{style:{"font-size":"12px"}},"Browse files",-1)),yt=b(()=>l("br",null,null,-1)),bt={class:"input_field"},xt=b(()=>l("p",{style:{"text-align":"left","font-weight":"bold"}}," Driver's license Number (Number 5): ",-1)),$t=b(()=>l("br",null,null,-1)),Ct=b(()=>l("br",null,null,-1)),Ft={class:"input_field"},wt=b(()=>l("p",{style:{"text-align":"left","font-weight":"bold"}}," Driver's license Expiration Date: ",-1)),Vt=b(()=>l("br",null,null,-1)),St=b(()=>l("br",null,null,-1)),It=b(()=>l("br",null,null,-1)),kt={__name:"UploadDocuments",setup(e){const r=I(null),f=I(null),v=I(""),o=I(null),s=I(!1),i=pe();async function m(){if(!(!r.value||!f.value)){s.value=!0;try{const h=`${x()}_front.${P(r.value.name)}`,p=`${x()}_back.${P(f.value.name)}`;await w(h,r.value),await w(p,f.value);const{data:$,error:D}=await W.from("verification").upsert({id:q.state.session.user.id,driver_license_front:h,driver_license_back:p,driver_license_number:v.value,driver_license_exp_date:o.value},{onConflict:["id"]});D?console.error("Error updating verification:",D.message):i.notify({position:"top",color:"positive",message:"Verification data uploaded successfully"})}catch(h){console.error("Unexpected error:",h.message)}finally{s.value=!1}}}async function w(h,p){return new Promise(async($,D)=>{try{const{data:c,error:A}=await W.storage.from("licences").upload(h,p,{cacheControl:"3600",upsert:!1});A?(console.error("Error uploading file:",A.message),D(A.message)):$(c.Key)}catch(c){D(c.message)}})}function x(){return Math.random().toString(36).substring(2,15)}function P(h){return h?h.split(".").pop():""}return(h,p)=>(k(),U("div",ut,[ct,t(g,{color:"green",style:{width:"120%","margin-left":"-10%"}}),t(g,{color:"green",style:{width:"120%","margin-left":"-10%"}}),t(g,{color:"green",style:{width:"120%","margin-left":"-10%"}}),dt,l("div",ft,[mt,t(le,{modelValue:r.value,"onUpdate:modelValue":p[0]||(p[0]=$=>r.value=$),color:"green-7"},null,8,["modelValue"]),pt]),t(g,{color:"green-3",style:{width:"110%","margin-left":"-5%"}}),t(g,{color:"green-3",style:{width:"110%","margin-left":"-5%"}}),gt,l("div",_t,[vt,t(le,{modelValue:f.value,"onUpdate:modelValue":p[1]||(p[1]=$=>f.value=$),color:"green-7"},null,8,["modelValue"]),ht]),t(g,{color:"green-3",style:{width:"110%","margin-left":"-5%"}}),t(g,{color:"green-3",style:{width:"110%","margin-left":"-5%"}}),yt,l("div",bt,[xt,t(Me,{modelValue:v.value,"onUpdate:modelValue":p[2]||(p[2]=$=>v.value=$),color:"green-7",type:"text",placeholder:"E.g. 123456789"},null,8,["modelValue"])]),$t,t(g,{color:"green-3",style:{width:"110%","margin-left":"-5%"}}),t(g,{color:"green-3",style:{width:"110%","margin-left":"-5%"}}),Ct,l("div",Ft,[wt,t(Je,{modelValue:o.value,"onUpdate:modelValue":p[3]||(p[3]=$=>o.value=$),color:"green-5"},null,8,["modelValue"])]),Vt,St,t(g,{color:"green",style:{width:"120%","margin-left":"-10%"}}),t(g,{color:"green",style:{width:"120%","margin-left":"-10%"}}),t(g,{color:"green",style:{width:"120%","margin-left":"-10%"}}),It,t(Q,{onClick:m,color:"green-7",label:"Upload",loading:s.value},null,8,["loading"])]))}};var Pt=G(kt,[["__scopeId","data-v-5dcab339"]]);const zt=Fe({setup(){return{authStore:q}}}),Dt=l("h4",null,"Welcome,",-1),At=l("p",null,"In this section you can:",-1),Nt=l("li",null,"Update your profile's information",-1),Qt=l("li",null,"Upload documents (e.g. driver's license)",-1),Ut=l("li",null,"Or even delete your account*",-1),qt=l("br",null,null,-1),Et=l("br",null,null,-1),jt=l("br",null,null,-1),Bt=l("br",null,null,-1),Ot=l("br",null,null,-1),Tt=l("br",null,null,-1),Mt={key:0},Jt={key:1},Lt={key:2},Rt={key:3},Yt=l("br",null,null,-1),Ht=l("br",null,null,-1),Wt=l("p",{style:{"font-size":"12px"}},"*well that doesn't work yet :)",-1);function Gt(e,r,f,v,o,s){return k(),U("div",null,[Dt,At,Nt,Qt,Ut,qt,Et,jt,t(ke,{src:Ne,style:{opacity:"50%"}}),Bt,Ot,Tt,e.authStore.state.profile.isVerified?T("",!0):(k(),U("div",Mt," Your account is not verified. ")),e.authStore.state.profile.isVerified?T("",!0):(k(),U("div",Jt," Upload the neccessary documents to get verified. ")),e.authStore.state.profile.isVerified?(k(),U("div",Lt," Your account is verified. ")):T("",!0),e.authStore.state.profile.isVerified?(k(),U("div",Rt," Now you can share your car or order someone else's. ")):T("",!0),Yt,Ht,Wt])}var Xt=G(zt,[["render",Gt]]);const Zt={components:{LeftPanelMenu:Ze,WelcomeProfile:Xt,ChangeAvatar:rt,UploadDocuments:Pt},data(){return{activePanel:"WelcomeProfile"}},methods:{togglePanels(e){this.activePanel=e}}},Kt={class:"flex xefl"},el={class:"right-panel"},tl={class:"q-pa-md flex flex-center"};function ll(e,r,f,v,o,s){const i=we("LeftPanelMenu");return k(),te(he,null,{default:_(()=>[l("div",Kt,[t(i,{togglePanel:s.togglePanels},null,8,["togglePanel"]),t(g,{vertical:"",inset:""}),l("div",el,[l("div",tl,[(k(),te(Ve(o.activePanel),{togglePanel:s.togglePanels},null,8,["togglePanel"]))])])])]),_:1})}var xl=G(Zt,[["render",ll],["__scopeId","data-v-691e678f"]]);export{xl as default};
